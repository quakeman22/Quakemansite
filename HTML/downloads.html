<!DOCTYPE html>
<html lang="pt-BR" class="dark">
<head>
  <meta charset="UTF-8">
  <title>Downloads - Novas Traduções J2ME</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: { accent: '#71dba7', background: '#0d0d0d', container: '#141414' },
          fontFamily: { pixel: ['"Pixelify Sans"', 'Arial', 'sans-serif'] },
        },
      },
    }
  </script>
  
  <link href="https://fonts.cdnfonts.com/css/pixelify-sans" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  
  <style>
    .loading { animation: pulse 1.5s infinite; }

    /* Essencial para eliminar scroll indesejado em iframe */
    html, body {
      height: auto !important;
      min-height: 0 !important;
      overflow: hidden !important;
      margin: 0;
      padding: 0;
    }
    body {
      display: flex;
      flex-direction: column;
    }
  </style>
</head>
<body class="bg-background text-gray-200 font-pixel">

  <div class="w-full max-w-6xl mx-auto px-4 py-8"> <!-- Reduzido de py-12 para py-8 -->
    <h1 class="text-4xl font-bold text-accent text-center mb-4">Novas Traduções J2ME</h1>
    <p class="text-center text-lg mb-8">Todos os jogos Java traduzidos para Português-BR disponíveis no repositório.<br>
       Clique no nome do jogo para baixar o arquivo .jar diretamente.</p>

    <div class="mb-6 text-center">
      <input type="text" id="searchInput" placeholder="Buscar jogo..." 
             class="px-4 py-2 rounded-lg bg-container border border-accent/50 text-white 
                    focus:outline-none focus:border-accent w-full max-w-md">
    </div>

    <div id="loading" class="text-center text-xl loading text-accent">
      <span class="material-icons text-5xl inline-block">cloud_download</span><br>
      Carregando lista de jogos...
    </div>

    <div id="error" class="hidden text-center text-red-400 text-xl"></div>

    <div id="gamesGrid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 hidden min-h-0">
      <!-- Os jogos serão inseridos aqui pelo JavaScript -->
    </div>

    <div class="mt-12 text-center text-gray-400">
      <p>Total de jogos: <span id="totalCount">0</span></p>
      <p class="mt-4">
        Repositório completo: 
        <a href="https://github.com/quakeman22/j2metraduzidos/tree/main/Novas%20Tradu%C3%A7%C3%B5es" 
           target="_blank" class="text-accent hover:underline">
          Ver no GitHub →
        </a>
      </p>
    </div>
  </div>

  <script>
    const apiUrl = 'https://api.github.com/repos/quakeman22/j2metraduzidos/contents/Novas%20Tradu%C3%A7%C3%B5es';
    const grid = document.getElementById('gamesGrid');
    const loading = document.getElementById('loading');
    const error = document.getElementById('error');
    const searchInput = document.getElementById('searchInput');
    const totalCount = document.getElementById('totalCount');
    let allGames = [];

    // Busca a lista de arquivos
    fetch(apiUrl)
      .then(response => {
        if (!response.ok) throw new Error('Erro ao carregar a lista (GitHub API limit?)');
        return response.json();
      })
      .then(data => {
        // Filtra só arquivos .jar
        const jarFiles = data.filter(item => item.name.toLowerCase().endsWith('.jar') && item.type === 'file');
        
        allGames = jarFiles.sort((a, b) => a.name.localeCompare(b.name));
        totalCount.textContent = allGames.length;
        
        renderGames(allGames);
        loading.classList.add('hidden');
        grid.classList.remove('hidden');
      })
      .catch(err => {
        loading.classList.add('hidden');
        error.classList.remove('hidden');
        error.textContent = 'Erro ao carregar os jogos: ' + err.message + '. Tente novamente mais tarde.';
      });

    // Renderiza os cards
    function renderGames(games) {
      grid.innerHTML = '';
      games.forEach(file => {
        const cleanName = file.name.replace(/\.jar$/i, '').replace(/\[.*?\]/g, '').trim(); // Remove .jar e resoluções
        const card = document.createElement('a');
        card.href = file.download_url;
        card.download = file.name;
        card.className = 'block p-5 bg-container rounded-lg border-2 border-accent/30 hover:border-accent hover:bg-accent/10 transition text-center';
        card.innerHTML = `
          <span class="material-icons text-5xl text-accent mb-3 block">videogame_asset</span>
          <h3 class="text-lg font-bold break-words">${cleanName}</h3>
          <p class="text-sm text-gray-400 mt-2">${file.name}</p>
        `;
        grid.appendChild(card);
      });
    }

    // Busca em tempo real
    searchInput.addEventListener('input', () => {
      const term = searchInput.value.toLowerCase();
      const filtered = allGames.filter(file => 
        file.name.toLowerCase().includes(term)
      );
      renderGames(filtered);
      totalCount.textContent = filtered.length + (term ? ' (filtrados)' : '');
    });
  </script>
</body>
</html>
